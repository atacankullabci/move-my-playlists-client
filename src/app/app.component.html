<app-header></app-header>

<mat-card class="mat-elevation-z8" style="margin: 30px" *ngIf="false">
  <mat-card-header>
    <mat-card-title>Welcome</mat-card-title>
    <mat-card-subtitle>This website migrates your iTunes library, playlists to Spotify.</mat-card-subtitle>
  </mat-card-header>
  <mat-card-content>
    <mat-list>
      <mat-list-item>
        <mat-icon mat-list-icon aria-hidden="false">more_time</mat-icon>
        It takes no more than couple of minutes
      </mat-list-item>
      <mat-list-item>
        <mat-icon mat-list-icon aria-hidden="false">money_off</mat-icon>
        Free to use
      </mat-list-item>
      <mat-list-item>
        <mat-icon mat-list-icon aria-hidden="false">person</mat-icon>
        No registration required
      </mat-list-item>
      <mat-list-item>
        <mat-icon mat-list-icon aria-hidden="false">code</mat-icon>
        An open source project you can check it out
      </mat-list-item>
    </mat-list>
  </mat-card-content>
  <mat-card-actions style="padding: 20px">
    <button mat-raised-button color="primary">SHARE</button>
    <button mat-raised-button color="accent">START</button>
  </mat-card-actions>
</mat-card>

<mat-tab-group dynamicHeight (selectedTabChange)="onTabClick($event)">
  <mat-tab label="Authorize Im Movin' App on Spotify">
    <div class="mat-elevation-z8" style="margin: 30px">
      <app-user-info *ngIf="isUserValid" [userInfo]="userInfo"></app-user-info>
      <mat-card *ngIf="!isUserValid">
        <mat-card-title>
          Im Movin' App needs a permission from your spotify account to modify your library.
        </mat-card-title>
        <mat-card-content>
          <button mat-raised-button type="button" color="accent" (click)="goToAuthPage()">Give Permission</button>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-tab>
  <mat-tab label="Import your iTunes Library" [disabled]="!isUserValid">
    <div class="mat-elevation-z8" style="margin: 30px">
      <mat-card>
        <mat-card-title>
          Upload your iTunes library
        </mat-card-title>
        <mat-divider></mat-divider>
        <mat-card-content>
          <mat-list>
            <mat-list-item role="listitem">1. Open your iTunes</mat-list-item>
            <mat-list-item role="listitem">2. File > Library > Export Library</mat-list-item>
            <mat-list-item role="listitem">3. Upload the exported "Library.xml" file to Im Movin' App</mat-list-item>
          </mat-list>
          <mat-divider></mat-divider>
          <mat-list>
            <mat-list-item role="listitem">
              <mat-checkbox (change)="parseSelections()"
                            [(ngModel)]="playlistOption"
                            matTooltip="Creates a new playlist for each playlist in your iTunes account
                             and imports into your Spotify account"
                            [matTooltipPosition]="'above'"
                            matTooltipHideDelay="200">
                Parse Playlists
              </mat-checkbox>
              <mat-checkbox (change)="parseSelections()"
                            [(ngModel)]="trackOption"
                            style="margin-left: 30px"
                            matTooltip="Parses the Library and saves each track to your Spotify 'Liked Songs' section"
                            [matTooltipPosition]="'above'"
                            matTooltipHideDelay="200">
                Parse Tracks
              </mat-checkbox>
            </mat-list-item>
          </mat-list>
        </mat-card-content>
        <button mat-raised-button
                type="button"
                color="accent"
                (click)="filePicker.click()"
                [disabled]="!mediaContentCanBeAdded">
          Upload File
        </button>
        <input type="file" #filePicker (change)="onFilePicked($event)">
      </mat-card>
    </div>
  </mat-tab>
  <mat-tab [disabled]="!isMediaContentReceived">
    <ng-template mat-tab-label>
      <span style="min-width: 10px"
            matBadge="{{contentBadge}}"
            class="stretch-badge"
            matBadgeOverlap="false"
            [matBadgeHidden]="!isMediaContentReceived">Tracks in Your Library</span>
    </ng-template>

    <mat-card class="mat-elevation-z8 card" *ngIf="!migrationCompleted">
      <mat-card-header>
        <mat-card-title>Migrate Tracks</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <p>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Im Movin' app is going to add all the tracks in your library
          into Spotify 'Liked Songs' tab.
        </p>
      </mat-card-content>
      <mat-card-actions style="text-align: center; margin-bottom: 5px">
        <button mat-raised-button type="button" color="accent" (click)="migrate()">Start Migration</button>
      </mat-card-actions>
    </mat-card>

    <mat-card class="mat-elevation-z8 card" *ngIf="migrationCompleted">
      <mat-card-title>
        You have been started migration of {{this.mediaContents.length}} tracks
      </mat-card-title>
      <mat-card-content>
        <p>
          According to your library size, this process might take a while.
          Please, check your spotify library.
        </p>
        <mat-progress-bar mode="indeterminate" color="accent" style="width:100% !important;"></mat-progress-bar>
      </mat-card-content>
    </mat-card>

    <mat-form-field>
      <mat-label>Search</mat-label>
      <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Fleetwood Mac" #input>
    </mat-form-field>
    <table mat-table [dataSource]="dataSource" matSort>
      <ng-container matColumnDef="trackName">
        <th mat-header-cell *matHeaderCellDef>Song</th>
        <td mat-cell *matCellDef="let element"> {{element.trackName}} </td>
      </ng-container>
      <ng-container matColumnDef="artistName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Artist</th>
        <td mat-cell *matCellDef="let element"> {{element.artistName}} </td>
      </ng-container>
      <ng-container matColumnDef="albumName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Album</th>
        <td mat-cell *matCellDef="let element"> {{element.albumName}} </td>
      </ng-container>
      <ng-container matColumnDef="genre">
        <th mat-header-cell *matHeaderCellDef mat-sort-header>Genre</th>
        <td mat-cell *matCellDef="let element"> {{element.genre}} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
      </tr>
    </table>
    <mat-paginator [pageSizeOptions]="[10, 15, 20]" showFirstLastButtons></mat-paginator>
  </mat-tab>
  <mat-tab [disabled]="!playlistReceived">
    <ng-template mat-tab-label>
      <span style="min-width: 10px"
            matBadge="{{playlistBadge}}"
            class="stretch-badge"
            matBadgeOverlap="false"
            [matBadgeHidden]="playlistBadge === 0">Playlists in Your Library</span>
    </ng-template>
    <app-playlist></app-playlist>
  </mat-tab>
</mat-tab-group>

<div class="overlay" *ngIf="showSpinnerOverlay">
  <div class="center">
    <mat-progress-spinner diameter=50
                          mode="indeterminate"
                          color="accent">
    </mat-progress-spinner>
  </div>
</div>
