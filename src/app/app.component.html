<app-header></app-header>

<!--
<mat-card  style="margin: 50px">
  <mat-card-header>
    <mat-card-title>Welcome</mat-card-title>
  </mat-card-header>
  <mat-card-content>
    <p>
      This website migrates your iTunes library, playlists to Spotify.
      It takes no more than couple of minutes, also its free to
      use.
      If you are a developer here is the source.
    </p>
  </mat-card-content>
  <mat-card-actions>
    <button mat-raised-button color="warn">LIKE</button>
    <button mat-raised-button color="primary">SHARE</button>
    <button mat-raised-button color="accent">START</button>
  </mat-card-actions>
</mat-card>
-->

<mat-tab-group dynamicHeight (selectedTabChange)="onTabClick($event)">
  <mat-tab label="Authorize Im Movin' App on Spotify">
    <div class="mat-elevation-z8" style="margin: 30px">
      <app-user-info *ngIf="isUserValid" [userInfo]="userInfo"></app-user-info>
      <mat-card *ngIf="!isUserValid">
        <mat-card-title>
          Im Movin' App needs a permission from your spotify account to modify your library.
        </mat-card-title>
        <mat-card-content>
          <button mat-raised-button type="button" color="accent" (click)="goToAuthPage()">Give Permission</button>
        </mat-card-content>
      </mat-card>
    </div>
  </mat-tab>
  <mat-tab label="Import your iTunes Library" [disabled]="!isUserValid">
    <div class="mat-elevation-z8" style="margin: 30px">
      <mat-card>
        <mat-card-title>
          Upload your iTunes library
        </mat-card-title>
        <mat-divider></mat-divider>
        <mat-card-content>
          <mat-list>
            <mat-list-item role="listitem">1. Open your iTunes</mat-list-item>
            <mat-list-item role="listitem">2. File > Library > Export Library</mat-list-item>
            <mat-list-item role="listitem">3. Upload the exported "Library.xml" file to Im Movin' App</mat-list-item>
          </mat-list>
          <mat-divider></mat-divider>
          <mat-list>
            <mat-list-item role="listitem">
              <mat-checkbox (change)="parseSelections()"
                            [(ngModel)]="playlistOption"
                            matTooltip="Creates a new playlist for each playlist in your iTunes account
                             and exports into your Spotify account"
                            [matTooltipPosition]="'above'"
                            matTooltipHideDelay="200">
                Parse Playlists
              </mat-checkbox>
              <mat-checkbox (change)="parseSelections()"
                            [(ngModel)]="trackOption"
                            style="margin-left: 30px"
                            matTooltip="Parses the Library and saves each track to your Spotify 'Liked Songs' section"
                            [matTooltipPosition]="'above'"
                            matTooltipHideDelay="200">
                Parse Tracks
              </mat-checkbox>
            </mat-list-item>
          </mat-list>
        </mat-card-content>
        <button mat-raised-button
                type="button"
                color="accent"
                (click)="filePicker.click()"
                [disabled]="!mediaContentCanBeAdded">
          Upload File
        </button>
        <input type="file" #filePicker (change)="onFilePicked($event)">
      </mat-card>
    </div>
  </mat-tab>
  <mat-tab [disabled]="!isMediaContentReceived">
    <ng-template mat-tab-label>
      <span style="min-width: 10px"
            matBadge="{{contentBadge}}"
            class="stretch-badge"
            matBadgeOverlap="false"
            [matBadgeHidden]="!isMediaContentReceived">Tracks in Your Library</span>
    </ng-template>
    <div class="mat-elevation-z8" style="margin: 30px">
      <mat-accordion class="example-headers-align" *ngIf="!migrationCompleted">
        <mat-expansion-panel hideToggle>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Tracks in Your Library
            </mat-panel-title>
            <mat-panel-description>
              All your tracks are shown here
              <mat-icon>list</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <mat-form-field>
            <mat-label>Search</mat-label>
            <input matInput (keyup)="applyFilter($event)" placeholder="Ex. Fleetwood Mac" #input>
          </mat-form-field>
          <table mat-table [dataSource]="dataSource" matSort>
            <ng-container matColumnDef="trackName">
              <th mat-header-cell *matHeaderCellDef>Song</th>
              <td mat-cell *matCellDef="let element"> {{element.trackName}} </td>
            </ng-container>
            <ng-container matColumnDef="artistName">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Artist</th>
              <td mat-cell *matCellDef="let element"> {{element.artistName}} </td>
            </ng-container>
            <ng-container matColumnDef="albumName">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Album</th>
              <td mat-cell *matCellDef="let element"> {{element.albumName}} </td>
            </ng-container>
            <ng-container matColumnDef="genre">
              <th mat-header-cell *matHeaderCellDef mat-sort-header>Genre</th>
              <td mat-cell *matCellDef="let element"> {{element.genre}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
            </tr>
          </table>
          <mat-paginator [pageSizeOptions]="[10, 15, 20]" showFirstLastButtons></mat-paginator>
        </mat-expansion-panel>
      </mat-accordion>
      <mat-accordion class="example-headers-align" *ngIf="!migrationCompleted">
        <mat-expansion-panel hideToggle>
          <mat-expansion-panel-header>
            <mat-panel-title>
              Start Migration
            </mat-panel-title>
            <mat-panel-description>
              Start your migration process
              <mat-icon>playlist_add</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>
          <button mat-raised-button type="button" color="primary" (click)="migrate()">Start Migration</button>
        </mat-expansion-panel>
      </mat-accordion>
      <mat-accordion class="example-headers-align" *ngIf="migrationCompleted">
        <mat-expansion-panel hideToggle>
          <mat-expansion-panel-header>
            <mat-panel-title>
              You have been started migration of {{this.mediaContents.length}} tracks
            </mat-panel-title>
            <mat-panel-description>
              <mat-progress-bar mode="indeterminate" style="width:80% !important;"></mat-progress-bar>
              <mat-icon>done_all</mat-icon>
            </mat-panel-description>
          </mat-expansion-panel-header>
          According to your library size, this process might take a while. Please, check your spotify library.
        </mat-expansion-panel>
      </mat-accordion>
    </div>
  </mat-tab>
  <mat-tab [disabled]="!playlistReceived">
    <ng-template mat-tab-label>
      <span style="min-width: 10px"
            matBadge="{{playlistBadge}}"
            class="stretch-badge"
            matBadgeOverlap="false"
            [matBadgeHidden]="playlistBadge === 0">Playlists in Your Library</span>
    </ng-template>
    <app-playlist></app-playlist>
  </mat-tab>
</mat-tab-group>

<div class="overlay" *ngIf="showSpinnerOverlay">
  <div class="center">
    <mat-progress-spinner diameter=50
                          mode="indeterminate"
                          color="accent">
    </mat-progress-spinner>
  </div>
</div>
